# 6.9 #
## MVCC ##

多版本并发控制

就是乐观锁的一种实现方式。

基本原理：
MVCC的实现，通过保存数据在某个时间点的快照来实现的。这意味着一个事务无论运行多长时间，在同一个事务里能够看到数据一致的视图。根据事务开始的时间不同，同时也意味着在同一时刻不同事务看到的相同表里的数据可能是不同的。

基本特征：
1. 每行数据都存在一个版本，每次数据更新时都更新该版本号。
2. 修改copy出当前版本随意修改，各个事务之间无干扰。
3. 保存时比较版本号，如果成功（commit），则覆盖记录；失败则放弃copy（rollback）。


InnoDB存储引擎MVCC的实现策略：
在每一行数据中额外保存两个隐藏的列：当前行创建时的版本号和删除时的版本号（可能为空，其实还有一系列称为回滚指针，用于事务回滚，不在文本范畴）。这里的版本号并不是实际的时间值，而是系统版本号。没开始新的事务，系统版本号都会自动递增。事务开始时刻的系统版本号会作为事务的版本号，用来和查询每行记录的版本号进行比较。

每个事务又有自己的版本号，这样事务内执行CURD操作时，就通过版本号的比较来达到数据版本控制目的。


## TCP、udp及HTTP ##
tcp/ip是个协议组，可分为三个层次：网络层、传输层、应用层
1. 网络层：IP协议，arp协议，icmp协议，rarp协议和bootp协议。
2. 传输层：tcp协议与udp协议。
3. 应用层：FTP\HTTP、TELNET、SMTP、DNS等协议。

因此，HTTP本身就是一个协议，是从web服务器常熟超文本到本地浏览器的传送协议。

## 订单金额计算流程 ##
1. 先计算商品金额（即：改完商品价格）
2. 促销后商品小计金额（即：满减、满折、满赠，优惠券）
3. 促销后订单金额（即：满减、满折、满赠）
4. 后续针对订单的优惠券、优惠码
5. 金额累计叠加后，再判断是否包邮，计算运费
6. 积分抵扣订单金额
7. 其他金额抵扣，如：后台人工修改金额（需要使用独立字段记录，金额上直接修改）