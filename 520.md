# 520 #




## 网站架构的演化![](https://i.imgur.com/HyiNqNz.png) ##

![](https://i.imgur.com/5ZGSNZZ.png)

![](https://i.imgur.com/FNEWxwV.png)

![](https://i.imgur.com/wcDhv8L.png)

![](https://i.imgur.com/13LJJXQ.png)

![](https://i.imgur.com/N47zjoD.png)

![](https://i.imgur.com/Hgf6Uko.png)

![](https://i.imgur.com/yC9pIMM.png)

![](https://i.imgur.com/ktaiywQ.png)

![](https://i.imgur.com/15rkNdj.png)

## 注意缓存的数据一致性（及时更新，模块缓存，定时缓存） ##
## 还有缓存雪崩，穿透，预热。。。。（因为穿透，导致一系列问题--->雪崩）（业务暂时降级...） ##

![](https://i.imgur.com/rSv6cTp.png)

![](https://i.imgur.com/uKXKjQU.png)

![](https://i.imgur.com/SYOldQ9.png)

![](https://i.imgur.com/lL1DHIc.png)

![](https://i.imgur.com/riINS16.png)

![](https://i.imgur.com/rwbOG6A.jpg)


## 服务器的硬件设备 ##
![](https://i.imgur.com/8vD0JtY.jpg)



web：终端
 1：服务器web：我们把提供（响应）服务的计算机称做服务器（server），也叫服务器端。
 
 2：接受（请求）服务的计算机称做客户机（client），也叫客户端。




php:（Hypertext Preprocessor）又叫超文本预处理器

那么何为超文本：超文本是用超链接的方法，将各种不同空间的文字信息组织在一起的网状文本。超文本更是一种用户界面范式，用以显示文本及与文本之间相关的内容。现时超文本普遍以电子文档方式存在，其中的文字包含有可以链结到其他位置或者文档的连结，允许从当前阅读位置直接切换到超文本连结所指向的位置。

## web服务器上php的运行模式 ##
1. CGI通用网关接口（Common Gateway Interface）

	：它是一段程序, 通俗的讲CGI就象是一座桥，把网页和WEB服务器中的执行程序连接起来，它把HTML接收的指令传递给服务器的执行程序，再把服务器执行程序的结果返还给HTML页。
2. fast-cgi(常驻（long-live）型的cgi)
3. cli命令行运行（Command Line InterFace）
4. web模块模式（apache等web服务器与逆行的模块模式）








# 多线程多进程协程的区别和不同的应用场景 #
- 并发：指的是任务数多余cpu核数，通过操作系统的各种任务调度算法，实现用多个任务“一起执行”（实际上总有一些任务不在执行，因为切换任务的速度相当快，看上去一起执行而已）
- 并行：指的是任务数小于等于cpu核数，就是任务真的是一起执行的。
- 多线程（threading）：
1. 在一个进程内的所有线程共享全局变量，很方便再多个线程间共享数据
2. 缺点就是，线程是对全局变量随意遂改可能造成多线程之间对全局变量的混乱（即线程非安全）
3. 如果多个线程同时对同一个全局变量操作，会出现资源竞争问题，从而数据结果会不正确。


- 携程（greenlet，gevent升级版）：
1. 比线程更小占用更小执行单位（理解为需要的资源）
2. 他是一个执行单元，因为它自带CPU上下文。
 通俗的理解：在一个线程中的某个函数，可以在任何地方保存当前函数的一些临时变量等信息，然后切换到另一个函数中执行，注意不是通过调用函数的方式做到的，并且切换的次数以及什么时候再切换到原来的函数都由开发者自己确定。
- 进程，能够完成多任务，比如 在一台电脑上能够同时运行多个QQ
- 线程，能够完成多任务，比如一个qq中的多个聊天窗口


## 区别 ##
- 一个程序至少有一个进程，一个进程至少有一个线程
- 进程的划分尺度小于进程（资源比进程少），使得多线程程序的并发性高
- 进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。
- 线程不能独立执行，必须存在在进程中
- 可以将进程理解为工厂中的一条流水线，而其中的线程就是这个流水线上的工人。



## 定义 ##
- 进程：是系统进行资源分配和调度的一个独立单位。
- 线程：是进程的一个实体，是cpu调度和分派的基本单位，他是比进程更小的能独立运行的基本单位。线程自己基本不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器，一组寄存器和栈），但是它可与同属一个进程的其他线程共享进程所拥有的全部资源。

## 优缺点 ##

线程和进程在使用上各有优缺点：线程执行开销小，但不利于资源的管理和保护；而进程正好相反。

## 小结 ##
- 进程是资源分配的的那位
- 线程是擦欧总系统调度的单位
- 进程切换需要的资源很大，效率很低
- 线程切换需要的资源一般，效率一般（淡然了在不考虑gil的情况下）
- 协程切换任务资源很小，效率高
- 多进程，多线程根据cpu核数不一样可能是并行的，但是协程是在一个线程中的，所以是并发。





## 应用场景 ##
- 多线程：常见的浏览器、维保服务（现在写的web是中间件帮你完成了线程的控制），web处理请求，，各种专用服务器，需要频繁的创建销毁的优先用线程。需要进行大量计算的优先使用线程（cpu频繁切换）
- 使用场所：目标动能交互少，如果资源和性能许可，可以设计由多个子应用程序来组合完成目的










# mysql的排他锁和共享锁 #
## 锁的基本概念 ##
当多事务争取一个资源时，有可能导致数据资源不一致，这个时候需要一种机制限制，并且将数据访问顺序化，用来保证数据库数据的一致性，锁就是其中的一种机制。
## 锁的基本类型 ##
数据库的操作可以归纳为两种：读和写

多个事务同时读取一个对象的时候，是不会有冲突的。同时读和写，或者同时写才会产生冲突。因此为了提高数据库的并发性能，通常会定义两种锁：共享锁和排他锁。

## 共享锁(Shared Lock,也叫S锁) ##
共享锁（S）表视对数据进行读操作。因此多个事务可以同时为一个对象加共享锁。(如果试衣间的门还没被锁上，顾客都能够同时进去参观)

产生共享锁的sql:select * from ad_plan lock in share mode;



